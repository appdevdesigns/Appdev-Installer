<!DOCTYPE html>
<html>
	<head>
    	<title>Appdev Installer</title>
			<link rel="stylesheet" href="modules/webix/webix.css" type="text/css">
			<link rel="stylesheet" href="css/appdev-installer.css" type="text/css"> 
			<script src="modules/webix/webix.js" type="text/javascript"></script>
			<script type="text/javascript">
				function node_version () {
					const spawn = require('child_process').spawn;
					const node_version_spawn = spawn('node', ['-v', '/usr']);
					
					node_version_spawn.stdout.on('data', (data) => {
						console.log(`stdout: ${data}`);
			            $$('installer-log').setValue(`${data}`);
					});

					node_version_spawn.stderr.on('data', (data) => {
						console.log(`stderr: ${data}`);
					});

					node_version_spawn.on('close', (code) => {
						console.log(`child process exited with code ${code}`);
					});  
				}

				function install_sails () {
					console.log('install sails');
					webix.message("Installing sails");
					const install_sails_exec = require('child_process').exec;
					install_sails_exec('echo "kiragames2016" | sudo -S npm install sails -g', (error, stdout, stderr) => {
					  if (error) {
					    console.error(`exec error: ${error}`);
					  	$$('installer-log').setValue(`${error}`);
					    return;
					  }
					  console.log(`stdout: ${stdout}`);
					  console.log(`stderr: ${stderr}`);
					  $$('installer-log').setValue(`${stdout}`);
					  install_appdevdesigns();
					});
				}

				function install_appdevdesigns () {
					console.log('install appdev-design');
					webix.message("Installing appdev-design");
					const install_appdevdesigns_exec = require('child_process').exec;
					install_appdevdesigns_exec('echo "kiragames2016" | sudo -S npm install appdevdesigns/appdev-cli -g', (error, stdout, stderr) => {
					  if (error) {
					    console.error(`exec error: ${error}`);
					  $$('installer-log').setValue(`${error}`);
					    return;
					  }
					  console.log(`stdout: ${stdout}`);
					  console.log(`stderr: ${stderr}`);
					  $$('installer-log').setValue(`${stdout}`);
					  webix.message("Installing appdev-design complete");
					});
				}

			</script>
  	</head>
  	<body>
  		<div id="appdevgui-home-component">
			<h1 class="page-header text-center">
				<br>Appdev GUI Cross-platform
			</h1>
			<div id="appdevgui-side-component">
		        <div id="appdevgui-side">
			      <script type="text/javascript" charset="utf-8">
			        webix.ui({
			          view:"list",
			          id:"side-menu",
			          width:200,
			          height:203,
			          container:"appdevgui-side",
			          template:"#title#",
			          select:true,
			          navigation: true,
			          css:"side-menu-list",
			          data:[
			            { "id":1, "title":"Choose Language", "page":"#" },
			            { "id":2, "title":"Choose Profile", "page":"#"  },
			            { "id":3, "title":"Verify Requirements", "page":"#"  },
			            { "id":4, "title":"Configure Database", "page":"#"  },
			            { "id":5, "title":"Configure Site", "page":"#"  },
			            { "id":6, "title":"Finish", "page":"#"  }
			          ]
			        });
			        $$('side-menu').attachEvent("onItemClick", function(id, e, node){
			            var item = this.getItem(id);
			        });
			        $$('side-menu').select(6);
			      </script>
			    </div>
		    </div>
		    <div id="appdevgui-installer-component">
			    <div id="appdevgui-installer">
			      <script type="text/javascript" charset="utf-8">
			      	webix.ui({
			      		view: "textarea", 
			          	container: "appdevgui-installer",
			      		height: 230,
			      		labelPosition: "top",
			      		hidden: true,
			      		id: "installer-log"
			      	});
			        webix.ui({
			          view:"button",
			          container:"appdevgui-installer",
			          width: 200,
			          label: "Install",
			          id: "installer-button",
			          on:{
			            "onItemClick": function(id, e, trg) {
			              	webix.message("Installing Component"); 
			              	$$('installer-button').hide();
			              	$$('installer-log').show();
			              	node_version();
			              	install_sails();
			            }
			          }
			        });
			      </script>
			    </div>
		    </div>
    		<div class="clear"></div>
		</div>
  	</body>
</html>